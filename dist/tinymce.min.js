angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(a,b,c,d,e,f,g){return f=f||{},f.baseUrl&&(tinymce.baseURL=f.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(a,h,i,j){function k(a){a?(l(),n&&n.getBody().setAttribute("contenteditable",!1)):(l(),n&&!n.settings.readonly&&n.getDoc()&&n.getBody().setAttribute("contenteditable",!0))}function l(){n||(n=tinymce.get(i.id))}if(d.tinymce){var m,n,o=j[0],p=j[1]||null,q=null,r={debounce:!0},s=function(b){var c=b.getContent({format:r.format}).trim();q!==c&&(q=c,c=e.trustAsHtml(c),a.$evalAsync(function(){o.$setViewValue(c)}))},t=g.getUniqueId();i.$set("id",t),m={},angular.extend(m,a.$eval(i.uiTinymce));var u=function(a){var b;return function(d){c.cancel(b),b=c(function(){return function(a){a.isDirty()&&(a.save(),s(a))}(d)},a)}}(400),v={setup:function(b){b.on("init",function(){o.$render(),o.$setPristine(),o.$setUntouched(),p&&p.$setPristine()}),b.on("ExecCommand change NodeChange ObjectResized",function(){return r.debounce?void u(b):(b.save(),void s(b))}),b.on("blur",function(){a.$evalAsync(function(){h[0].blur(),o.$setTouched()})}),b.on("remove",function(){h.remove()}),f.setup&&f.setup(b,{updateView:s}),m.setup&&m.setup(b,{updateView:s})},format:m.format||"html",selector:"#"+i.id};angular.extend(r,f,m,v),c(function(){r.baseURL&&(tinymce.baseURL=r.baseURL);var b=tinymce.init(r);b&&"function"==typeof b.then?b.then(function(){k(a.$eval(i.ngDisabled))}):k(a.$eval(i.ngDisabled))}),o.$formatters.unshift(function(a){return a?e.trustAsHtml(a):""}),o.$parsers.unshift(function(a){return a?e.getTrustedHtml(a):""}),o.$render=function(){l();var a=o.$viewValue?e.getTrustedHtml(o.$viewValue):"";n&&n.getDoc()&&(n.setContent(a),n.fire("change"))},i.$observe("disabled",k);var w=a.$on("$tinymce:refresh",function(c,d){var e=i.id;if(angular.isUndefined(d)||d===e){var f=h.parent(),g=h.clone();g.removeAttr("id"),g.removeAttr("style"),g.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,e),f.append(b(g)(a)),w()}});a.$on("$destroy",function(){l(),n&&(n.remove(),n=null)})}}}}]).service("uiTinymceService",[function(){var a=function(){var a="ui-tinymce",b=0,c=function(){return b++,a+"-"+b};return{getUniqueId:c}};return new a}]);